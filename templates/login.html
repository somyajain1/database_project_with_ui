<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Email Subscription</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <nav class="bg-white shadow-lg">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between">
                <div class="flex space-x-7">
                    <div>
                        <a href="/" class="flex items-center py-4">
                            <span class="font-semibold text-gray-500 text-lg">Email Subscription</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto mt-10 px-4">
        <div class="text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Welcome</h1>
            <p class="text-xl text-gray-600 mb-8">Please sign in to continue</p>
            
            <!-- Login Form -->
            <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6 mb-8">
                <div id="loginContainer" class="space-y-4">
                    <button id="googleSignIn" 
                            class="w-full bg-white border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition duration-300 flex items-center justify-center space-x-2">
                        <img src="https://www.google.com/favicon.ico" alt="Google" class="w-5 h-5">
                        <span>Sign in with Google</span>
                    </button>
                </div>
                <div id="message" class="mt-4 text-center hidden">
                    <p class="text-red-500">Error message will appear here</p>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAXLKyKue10uBRenJvsC81GYQDl0eVXYHc",
            authDomain: "vibe-coding-cursor.firebaseapp.com",
            projectId: "vibe-coding-cursor",
            storageBucket: "vibe-coding-cursor.appspot.com",
            messagingSenderId: "1048387694267",
            appId: "1:1048387694267:web:a8750e49028e815d47c39e"
        };

        // Initialize Firebase
        try {
            window.fbApp = initializeApp(firebaseConfig);
            const auth = getAuth(window.fbApp);
            const provider = new GoogleAuthProvider();
            console.log('Firebase initialized successfully');

            // Handle Google Sign In
            document.getElementById('googleSignIn').addEventListener('click', async () => {
                try {
                    const result = await signInWithPopup(auth, provider);
                    const idToken = await result.user.getIdToken();
                    console.log('Got ID token');

                    // Send token to backend for verification
                    const response = await fetch('/api/verify-token', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ idToken })
                    });

                    if (response.ok) {
                        // Redirect to home page after successful login
                        window.location.href = '/';
                    } else {
                        const error = await response.json();
                        throw new Error(error.error || 'Login failed');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    const messageDiv = document.getElementById('message');
                    messageDiv.querySelector('p').textContent = error.message;
                    messageDiv.classList.remove('hidden');
                }
            });
        } catch (error) {
            console.error('Firebase initialization error:', error);
            const messageDiv = document.getElementById('message');
            messageDiv.querySelector('p').textContent = 'Failed to initialize Firebase: ' + error.message;
            messageDiv.classList.remove('hidden');
        }
    </script>
</body>
</html> 